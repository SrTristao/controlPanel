"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const userService = require("../../services/User");
const userRepository = require("../../repositories/User");
const const_1 = require("../../../utils/const");
async function findById(req, res, next) {
    try {
        const result = await userService.findById(req.params.id);
        if (result)
            res.status(200).send(result);
        else
            res.status(401).send({ message: const_1.CONST.MSG.ERR.FINDBYID });
    }
    catch (err) {
        errorHandler(err, res, next);
    }
}
exports.findById = findById;
async function list(req, res, next) {
    try {
        const result = await userService.list(req.params.filter);
        res.status(200).send(result);
    }
    catch (err) {
        errorHandler(err, res, next);
    }
}
exports.list = list;
async function saveUser(req, res, next) {
    try {
        const result = await userService.saveUser(req.body);
        if (result)
            res.status(200).send({ message: const_1.CONST.MSG.SUCCESS.SAVE, user: result });
        else
            res.status(401).send({ message: const_1.CONST.MSG.ERR.SAVE });
    }
    catch (err) {
        errorHandler(err, res, next);
    }
}
exports.saveUser = saveUser;
async function deleteUser(req, res, next) {
    try {
        const result = await userService.deleteUser(req.params.id);
        if (result)
            res.status(200).send({ message: const_1.CONST.MSG.SUCCESS.DELETE });
        else
            res.status(401).send({ message: const_1.CONST.MSG.ERR.DELETE });
    }
    catch (err) {
        next(err);
    }
}
exports.deleteUser = deleteUser;
async function updateUser(req, res, next) {
    try {
        const result = await userService.updateUser(req.body);
        if (result)
            res.status(200).send({ message: const_1.CONST.MSG.SUCCESS.UPDATE });
        else
            res.status(401).send({ message: const_1.CONST.MSG.ERR.UPDATE });
    }
    catch (err) {
        errorHandler(err, res, next);
    }
}
exports.updateUser = updateUser;
async function changePassword(req, res, next) {
    try {
        const result = await userService.changePassword(req.body);
        if (result) {
            res.setHeader('X-Token', result);
            res.status(200).send({ message: 'Senha alterada com sucesso!' });
        }
        else
            res.status(401).send({ message: const_1.CONST.MSG.ERR.UPDATE });
    }
    catch (err) {
        errorHandler(err, res, next);
    }
}
exports.changePassword = changePassword;
async function lastInserts(req, res, next) {
    try {
        const result = await userRepository.lastInserts();
        res.status(200).send(result);
    }
    catch (err) {
        next(err);
    }
}
exports.lastInserts = lastInserts;
async function totUsers(req, res, next) {
    try {
        const result = await userRepository.selectCount();
        res.status(200).send({ count: result });
    }
    catch (err) {
        next(err);
    }
}
exports.totUsers = totUsers;
function errorHandler(err, res, next) {
    switch (err.message) {
        case 'user-already-created':
            return res.status(401).send({ message: 'Usuário já registrado.' });
        case 'object-invalid':
            return res.status(401).send({ message: 'Usuário inválido.' });
        case 'invalid-object-id':
            return res.status(401).send({ message: 'Parametro inválido.' });
        case 'parameter-not-expected':
            return res.status(401).send({ message: 'Parametro não experado.' });
        case 'user-not-found':
            return res.status(404).send({ message: 'Usuário não encontrado.' });
        case 'user-inactive':
            return res.status(403).send({ message: 'Usuário inativo.' });
        case 'invalid-password':
            return res.status(400).send({ message: 'Senha inválida.' });
        default:
            next(err);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NlcnZlci9hZG1pbi9yb3V0ZXMvdXNlci9hY3Rpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsbURBQW1EO0FBQ25ELDBEQUEwRDtBQUMxRCxnREFBNkM7QUFFdEMsS0FBSyxtQkFBbUIsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQjtJQUMxRSxJQUFJLENBQUM7UUFDRCxNQUFNLE1BQU0sR0FBRyxNQUFNLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6RCxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUM7WUFDTixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxJQUFJO1lBQ0EsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsYUFBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFDLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNYLFlBQVksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2pDLENBQUM7QUFDTCxDQUFDO0FBVkQsNEJBVUM7QUFFTSxLQUFLLGVBQWUsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQjtJQUN0RSxJQUFJLENBQUM7UUFDRCxNQUFNLE1BQU0sR0FBRyxNQUFNLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNYLFlBQVksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2pDLENBQUM7QUFDTCxDQUFDO0FBUEQsb0JBT0M7QUFFTSxLQUFLLG1CQUFtQixHQUFZLEVBQUUsR0FBYSxFQUFFLElBQWtCO0lBQzFFLElBQUksQ0FBQztRQUNELE1BQU0sTUFBTSxHQUFHLE1BQU0sV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEQsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ0wsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsYUFBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO1FBQzFFLElBQUk7WUFDQSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxhQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUMsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ1gsWUFBWSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDakMsQ0FBQztBQUNMLENBQUM7QUFWRCw0QkFVQztBQUVNLEtBQUsscUJBQXFCLEdBQVksRUFBRSxHQUFhLEVBQUUsSUFBa0I7SUFDNUUsSUFBSSxDQUFDO1FBQ0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxXQUFXLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDM0QsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDO1lBQ04sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsYUFBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztRQUM5RCxJQUFJO1lBQ0EsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsYUFBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNYLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNkLENBQUM7QUFDTCxDQUFDO0FBVkQsZ0NBVUM7QUFFTSxLQUFLLHFCQUFxQixHQUFZLEVBQUUsR0FBYSxFQUFFLElBQWtCO0lBQzVFLElBQUksQ0FBQztRQUNELE1BQU0sTUFBTSxHQUFHLE1BQU0sV0FBVyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEQsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDO1lBQ04sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsYUFBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztRQUM5RCxJQUFJO1lBQ0EsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsYUFBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNYLFlBQVksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ2pDLENBQUM7QUFDTCxDQUFDO0FBVkQsZ0NBVUM7QUFFTSxLQUFLLHlCQUF5QixHQUFZLEVBQUUsR0FBWSxFQUFFLElBQWtCO0lBQy9FLElBQUksQ0FBQztRQUNELE1BQU0sTUFBTSxHQUFHLE1BQU0s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QU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO1FBQy9ELEtBQUssa0JBQWtCO1lBQ3JCLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxDQUFDLENBQUM7UUFDOUQ7WUFDRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRGdW5jdGlvbiwgUmVxdWVzdCwgUmVzcG9uc2UgfSAgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgKiBhcyB1c2VyU2VydmljZSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9Vc2VyJztcbmltcG9ydCAqIGFzIHVzZXJSZXBvc2l0b3J5IGZyb20gJy4uLy4uL3JlcG9zaXRvcmllcy9Vc2VyJztcbmltcG9ydCB7IENPTlNUIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvY29uc3QnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluZEJ5SWQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIDogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2UuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XG4gICAgICAgIGlmKHJlc3VsdCkgICAgICAgICAgICBcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHJlc3VsdCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHttZXNzYWdlOiBDT05TVC5NU0cuRVJSLkZJTkRCWUlEfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGVycm9ySGFuZGxlcihlcnIsIHJlcywgbmV4dCk7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJTZXJ2aWNlLmxpc3QocmVxLnBhcmFtcy5maWx0ZXIpOyBcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzdWx0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgZXJyb3JIYW5kbGVyKGVyciwgcmVzLCBuZXh0KTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlVXNlcihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7ICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2Uuc2F2ZVVzZXIocmVxLmJvZHkpOyBcbiAgICAgIGlmIChyZXN1bHQpXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZCh7bWVzc2FnZTogQ09OU1QuTVNHLlNVQ0NFU1MuU0FWRSwgdXNlcjogcmVzdWx0fSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHttZXNzYWdlOiBDT05TVC5NU0cuRVJSLlNBVkV9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgZXJyb3JIYW5kbGVyKGVyciwgcmVzLCBuZXh0KTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVVc2VyKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2UuZGVsZXRlVXNlcihyZXEucGFyYW1zLmlkKTsgXG4gICAgICAgIGlmKHJlc3VsdCkgICAgICAgICAgICBcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHttZXNzYWdlOiBDT05TVC5NU0cuU1VDQ0VTUy5ERUxFVEV9KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDEpLnNlbmQoe21lc3NhZ2U6IENPTlNULk1TRy5FUlIuREVMRVRFfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIG5leHQoZXJyKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVVc2VyKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2UudXBkYXRlVXNlcihyZXEuYm9keSk7IFxuICAgICAgICBpZihyZXN1bHQpICAgICAgICAgICAgXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZCh7bWVzc2FnZTogQ09OU1QuTVNHLlNVQ0NFU1MuVVBEQVRFfSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHttZXNzYWdlOiBDT05TVC5NU0cuRVJSLlVQREFURX0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBlcnJvckhhbmRsZXIoZXJyLCByZXMsIG5leHQpO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkKHJlcTogUmVxdWVzdCwgcmVzOlJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5jaGFuZ2VQYXNzd29yZChyZXEuYm9keSk7XG4gICAgICAgIGlmKHJlc3VsdCkge1xuICAgICAgICAgICAgcmVzLnNldEhlYWRlcignWC1Ub2tlbicsIHJlc3VsdCk7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZCh7bWVzc2FnZTonU2VuaGEgYWx0ZXJhZGEgY29tIHN1Y2Vzc28hJ30pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHttZXNzYWdlOiBDT05TVC5NU0cuRVJSLlVQREFURX0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBlcnJvckhhbmRsZXIoZXJyLCByZXMsIG5leHQpO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxhc3RJbnNlcnRzKHJlcTogUmVxdWVzdCwgcmVzOlJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyUmVwb3NpdG9yeS5sYXN0SW5zZXJ0cygpO1xuICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXN1bHQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBuZXh0KGVycik7XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdG90VXNlcnMocmVxOiBSZXF1ZXN0LCByZXM6UmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LnNlbGVjdENvdW50KCk7XG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtjb3VudDogcmVzdWx0fSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIG5leHQoZXJyKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGVycm9ySGFuZGxlcihlcnI6IEVycm9yLCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBhbnkge1xuICAgIHN3aXRjaCAoZXJyLm1lc3NhZ2UpIHsgICAgXG4gICAgIGNhc2UgJ3VzZXItYWxyZWFkeS1jcmVhdGVkJyAgOlxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoe21lc3NhZ2U6ICdVc3XDoXJpbyBqw6EgcmVnaXN0cmFkby4nfSlcbiAgICAgIGNhc2UgJ29iamVjdC1pbnZhbGlkJzpcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHttZXNzYWdlOiAnVXN1w6FyaW8gaW52w6FsaWRvLid9KVxuICAgICAgY2FzZSAnaW52YWxpZC1vYmplY3QtaWQnOlxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoeyBtZXNzYWdlOiAnUGFyYW1ldHJvIGludsOhbGlkby4nfSk7XG4gICAgICBjYXNlICdwYXJhbWV0ZXItbm90LWV4cGVjdGVkJzpcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHsgbWVzc2FnZTogJ1BhcmFtZXRybyBuw6NvIGV4cGVyYWRvLid9KVxuICAgICAgY2FzZSAndXNlci1ub3QtZm91bmQnOlxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLnNlbmQoeyBtZXNzYWdlOiAnVXN1w6FyaW8gbsOjbyBlbmNvbnRyYWRvLicgfSk7XG4gICAgICBjYXNlICd1c2VyLWluYWN0aXZlJzpcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHsgbWVzc2FnZTogJ1VzdcOhcmlvIGluYXRpdm8uJyB9KTtcbiAgICAgIGNhc2UgJ2ludmFsaWQtcGFzc3dvcmQnOlxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoeyBtZXNzYWdlOiAnU2VuaGEgaW52w6FsaWRhLicgfSk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuZXh0KGVycik7XG4gICAgfVxuICB9XG4iXX0=