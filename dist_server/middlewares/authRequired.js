"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lodash = require("lodash");
function authRequired(roles = null) {
    return async (req, res, next) => {
        if (req.method === 'OPTIONS') {
            return next();
        }
        if (!req.user) {
            return res.status(401).send({ error: 'authorization token missing or invalid, sorry' });
        }
        if (!roles) {
            return next();
        }
        const rolesArray = lodash.flattenDeep([roles, ['admin']]);
        const isAuthorized = rolesArray.some(role => req.user.role === role);
        if (!isAuthorized) {
            return res.status(403).send({ error: 'you dont have the access rights to access this url' });
        }
        next();
    };
}
exports.authRequired = authRequired;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aFJlcXVpcmVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc2VydmVyL21pZGRsZXdhcmVzL2F1dGhSZXF1aXJlZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUFpQztBQUdqQyxzQkFBNkIsUUFBMkIsSUFBSTtJQUUxRCxNQUFNLENBQUMsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsSUFBa0IsRUFBZ0IsRUFBRTtRQUM3RSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDN0IsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hCLENBQUM7UUFFRCxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLCtDQUErQyxFQUFFLENBQUMsQ0FBQztRQUMxRixDQUFDO1FBRUQsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1gsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hCLENBQUM7UUFFRCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFELE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsQ0FBQztRQUVyRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDbEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLG9EQUFvRCxFQUFFLENBQUMsQ0FBQztRQUMvRixDQUFDO1FBRUQsSUFBSSxFQUFFLENBQUM7SUFDVCxDQUFDLENBQUM7QUFFSixDQUFDO0FBekJELG9DQXlCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGxvZGFzaCBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgTmV4dEZ1bmN0aW9uLCBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xuXG5leHBvcnQgZnVuY3Rpb24gYXV0aFJlcXVpcmVkKHJvbGVzOiBzdHJpbmcgfCBzdHJpbmdbXSA9IG51bGwpOiAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IFByb21pc2U8dm9pZD4ge1xuXG4gIHJldHVybiBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiBQcm9taXNlPGFueT4gPT4geyAgICBcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgICByZXR1cm4gbmV4dCgpO1xuICAgIH1cbiAgICAgICAgXG4gICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHsgZXJyb3I6ICdhdXRob3JpemF0aW9uIHRva2VuIG1pc3Npbmcgb3IgaW52YWxpZCwgc29ycnknIH0pO1xuICAgIH1cblxuICAgIGlmICghcm9sZXMpIHtcbiAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgfVxuXG4gICAgY29uc3Qgcm9sZXNBcnJheSA9IGxvZGFzaC5mbGF0dGVuRGVlcChbcm9sZXMsIFsnYWRtaW4nXV0pO1xuICAgIGNvbnN0IGlzQXV0aG9yaXplZCA9IHJvbGVzQXJyYXkuc29tZShyb2xlID0+IHJlcS51c2VyLnJvbGUgPT09IHJvbGUpO1xuXG4gICAgaWYgKCFpc0F1dGhvcml6ZWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZCh7IGVycm9yOiAneW91IGRvbnQgaGF2ZSB0aGUgYWNjZXNzIHJpZ2h0cyB0byBhY2Nlc3MgdGhpcyB1cmwnIH0pO1xuICAgIH1cblxuICAgIG5leHQoKTtcbiAgfTtcblxufVxuIl19