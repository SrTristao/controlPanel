"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _ = require('underscore');
function updateDocument(doc, SchemaTarget, data) {
    for (let field of SchemaTarget.schema.paths) {
        if ((field !== '_id') && (field !== '__v')) {
            let newValue = getObjValue(field, data);
            if (newValue !== undefined) {
                setObjValue(field, doc, newValue);
            }
        }
    }
    return doc;
}
exports.updateDocument = updateDocument;
;
function getObjValue(field, data) {
    return _.reduce(field.split("."), function (obj, f) {
        if (obj)
            return obj[f];
    }, data);
}
function setObjValue(field, data, value) {
    let fieldArr = field.split('.');
    return _.reduce(fieldArr, function (o, f, i) {
        if (i == fieldArr.length - 1) {
            o[f] = value;
        }
        else {
            if (!o[f])
                o[f] = {};
        }
        return o[f];
    }, data);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlRG9jdW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zZXJ2ZXIvdXRpbHMvdXBkYXRlRG9jdW1lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFaEMsd0JBQStCLEdBQUcsRUFBRSxZQUFZLEVBQUUsSUFBSTtJQUNsRCxHQUFHLENBQUMsQ0FBQyxJQUFJLEtBQUssSUFBSSxZQUFZLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDM0MsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLElBQUksUUFBUSxHQUFHLFdBQVcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDeEMsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pCLFdBQVcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ3hDLENBQUM7UUFDSixDQUFDO0lBQ0osQ0FBQztJQUNELE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDZixDQUFDO0FBVkQsd0NBVUM7QUFBQSxDQUFDO0FBRUYscUJBQXFCLEtBQUssRUFBRSxJQUFJO0lBQzVCLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsVUFBUyxHQUFHLEVBQUUsQ0FBQztRQUM3QyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUM7WUFBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNiLENBQUM7QUFFRCxxQkFBcUIsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLO0lBQ3JDLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLFVBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBQ3ZDLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUNsQixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSCxFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLENBQUM7UUFDRCxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2YsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ1gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJyk7XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVEb2N1bWVudChkb2MsIFNjaGVtYVRhcmdldCwgZGF0YSkge1xuICAgIGZvciAobGV0IGZpZWxkIG9mIFNjaGVtYVRhcmdldC5zY2hlbWEucGF0aHMpIHtcbiAgICAgICBpZiAoKGZpZWxkICE9PSAnX2lkJykgJiYgKGZpZWxkICE9PSAnX192JykpIHtcbiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IGdldE9ialZhbHVlKGZpZWxkLCBkYXRhKTtcbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgc2V0T2JqVmFsdWUoZmllbGQsIGRvYywgbmV3VmFsdWUpO1xuICAgICAgICAgIH0gIFxuICAgICAgIH0gIFxuICAgIH1cbiAgICByZXR1cm4gZG9jO1xufTtcblxuZnVuY3Rpb24gZ2V0T2JqVmFsdWUoZmllbGQsIGRhdGEpIHtcbiAgICByZXR1cm4gXy5yZWR1Y2UoZmllbGQuc3BsaXQoXCIuXCIpLCBmdW5jdGlvbihvYmosIGYpIHsgXG4gICAgICAgIGlmKG9iaikgcmV0dXJuIG9ialtmXTtcbiAgICB9LCBkYXRhKTtcbn1cblxuZnVuY3Rpb24gc2V0T2JqVmFsdWUoZmllbGQsIGRhdGEsIHZhbHVlKSB7XG4gIGxldCBmaWVsZEFyciA9IGZpZWxkLnNwbGl0KCcuJyk7XG4gIHJldHVybiBfLnJlZHVjZShmaWVsZEFyciwgZnVuY3Rpb24obywgZiwgaSkge1xuICAgICBpZihpID09IGZpZWxkQXJyLmxlbmd0aC0xKSB7XG4gICAgICAgICAgb1tmXSA9IHZhbHVlO1xuICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmKCFvW2ZdKSBvW2ZdID0ge307XG4gICAgIH1cbiAgICAgcmV0dXJuIG9bZl07XG4gIH0sIGRhdGEpO1xufSJdfQ==